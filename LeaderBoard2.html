<!DOCTYPE html>
<html>
<head>
  <title>Leaderboard2</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #fdd835;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .back-button {
      margin-bottom: 20px;
      display: inline-block;
      text-decoration: none;
      padding: 10px 20px;
      background: #764ba2;
      color: #fff;
      border-radius: 20px;
    }

    .back-button:hover {
      background: #667eea;
    }
  </style>
</head>
<body>
  <a href="pick.html" class="back-button">← Back to Picks</a>
  <h1>Today's Leaderboard</h1>
  <table id="leaderboardTable">
    <thead>
      <tr>
        <th>User</th>
        <th>Pick</th>
        <th>Submitted At</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be inserted here -->
    </tbody>
  </table>

  <script>
    const db = firebase.firestore();
    const auth = firebase.auth();

   auth.onAuthStateChanged(async user => {
  if (!user) {
    window.location.href = "index.html";
    return;
  }

  const today = new Date().toISOString().split('T')[0];
  console.log("Looking for picks on:", today); // ✅ Log the date
  const tableBody = document.querySelector('#leaderboardTable tbody');

  try {
    const snapshot = await db.collection('picks').doc(today).collection('users').orderBy('timestamp').get();
    console.log("Snapshot size:", snapshot.size); // ✅ Log snapshot

    if (snapshot.empty) {
      tableBody.innerHTML = '<tr><td colspan="3">No picks yet today.</td></tr>';
      return;
    }

    snapshot.forEach(doc => {
      const data = doc.data();
      const row = document.createElement('tr');

      const nameCell = document.createElement('td');
      nameCell.textContent = data.name || 'Anonymous';

      const pickCell = document.createElement('td');
      pickCell.textContent = data.cyclist || 'N/A';

      const timeCell = document.createElement('td');
      const ts = data.timestamp?.toDate();
      timeCell.textContent = ts ? ts.toLocaleTimeString() : 'Unknown';

      row.appendChild(nameCell);
      row.appendChild(pickCell);
      row.appendChild(timeCell);

      tableBody.appendChild(row);
    });
  } catch (error) {
    console.error("Error loading leaderboard:", error); // ⛳ Now logs full error
    tableBody.innerHTML = '<tr><td colspan="3">Error loading leaderboard data.</td></tr>';
  }
});
  </script>
</body>
</html>
