<!DOCTYPE html>
<html>
<head>
  <title>Leaderboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h1>Leaderboard</h1>
  <ul id="board"></ul>

  <script>
    const db = firebase.firestore();
    const board = document.getElementById('board');

    async function loadLeaderboard() {
      const scores = {};
      const stages = await db.collection('stages').get();
      for (let stage of stages.docs) {
        const winner = stage.data().winner;
        const stageId = stage.id;
        const picks = await db.collection('picks').doc(stageId).collection('users').get();

        picks.forEach(doc => {
          const { name, cyclist } = doc.data();
          if (!scores[name]) scores[name] = 0;
          if (cyclist.toLowerCase() === winner.toLowerCase()) scores[name]++;
        });
      }

      const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
      board.innerHTML = sorted.map(([name, score]) => `<li>${name}: ${score}</li>`).join('');
    }

    loadLeaderboard();
  </script>
</body>
</html>
